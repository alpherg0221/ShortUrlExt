# Kanper

![kanper-demo](https://user-images.githubusercontent.com/41366495/194407259-08027246-0de6-4101-98c6-4af273220a10.gif)

## Table of Contents

for general
- About
- 導入方法
- 機能一覧

for developers
- リポジトリの構成
- 構成技術
- 開発ロードマップ
- License

for MWSCup
- 審査基準について

## About

短縮URLを検知し，確認ページで移動先の情報を表示することでユーザを危険なページから保護するブラウザ拡張機能です．

短縮URLとは，Bitlyなどの短縮URLプロバイダから提供される，正規のURLにリダイレクトされる短めなURLのことです．
長いURLを短くでき便利な反面，悪質サイトへのURLが隠されてしまうためフィッシングなどに悪用されるという問題点があります．
このツールは，短縮URLにアクセスしたときに遷移先ページの情報を表示することで，危険なページへのアクセスを防止することを目的とします．

> このツールは`MWSCup 2022 事前課題`として`Undanomi`が作成しました．

## できること

この拡張機能を用いることで以下のことが可能になります．

1. 短縮URLを展開し，どこへリンクされているのか知ることができる．
2. 短縮URLにアクセスした場合に，リンク先へアクセスする前に確認できる．
3. ブラックリスト・ホワイトリストを活用しUXを損なわずに安全性を確保できる．
4. プライバシーに配慮し，上記に関係する処理を所有端末内で完結することができる．

## 導入方法

1. このリポジトリの[Release](https://github.com/alpherg0221/ShortUrlExt/releases)をクリック
2. 一番上の最新バージョンのrelease.zipをダウンロードして解凍
3. Chrome「設定」→「拡張機能」をクリックし，拡張機能編集ページを開く
4. 右上のディベロッパーモードをオンにし，「パッケージ化されていない拡張機能を読み込む」をクリック
5. 解凍したファイル(frontend)を選択

この拡張機能のコアである短縮URLの展開機能について，Chrome拡張機能を導入せずに内容を確認できるように[デモページ](https://alpherg0221.github.io/ShortUrlExt/)を用意しています．ただし，拡張機能がないと自動的な割り込み対応などはできません．

## 機能一覧

### 遷移確認ページ

短縮URLにアクセスしたとき，最初に表示されるページです．  
以下のものが表示されています．

- 遷移先URL
- ページタイトル
- ページの説明
- ページのサムネイル
  - サムネイルをクリックすることで解像度が上がります
- 安全性チェック
  - 遷移先のページが安全かどうかを外部サイトで確認することができます

遷移確認ページでは，以下の事ができます．

- 遷移先ページに移動
- 遷移先ページをホワイトリストに登録
- 遷移先ページをブラックリストに登録

### ホワイトリスト機能

安全と判明しているページをホワイトリストに登録することで，遷移確認ページ を省略することができます．拡張機能ポップアップからホワイトリストを編集できます．

短縮URLの遷移先のドメインがホワイトリストに登録されていれば，確認ページを表示せずに短縮URLのページにアクセスします．

### ブラックリスト機能

危険と判明しているページをブラックリストに登録することで，そのページにアクセスできないようにします．拡張機能ポップアップからブラックリストを編集できます．

短縮URLの遷移先のドメインがブラックリストに登録されていれば，確認ページにてダイアログを表示後，タブを閉じます．

### サーバの変更機能

拡張機能がアクセスするAPIサーバは自由に変えることができます．

**背景**

> この拡張機能は常にWebページの遷移を監視しながらサーバに自動的にアクセス情報などを送信しています．
>
> この挙動に対してプライバシー上の懸念が存在することは当然であり，このようなツールを利用すると思われるターゲット層で特に顕著だと考えています．しかしながらこの動作自体は今回のような機能を実現する上で必要不可欠であり，これ自体を避けることができないため，別のアプローチによる問題の解決を実装しました．
>
> 今回用意したのはセルフホスティングするサーバなどを用いることで，アクセス情報などを所有端末内で完結できるようにしました．具体的にはDockerやGolangによる可搬性を確保したバックエンドを自前のサーバに展開，同様にワーカーを起動しておくことにより，アクセス情報を処理するシステムを完全に制御することが可能になります．詳細については[バックエンドのREADME](https://github.com/alpherg0221/ShortUrlExt/tree/main/backend)を参照下さい．

### 拡張機能ポップアップ

右上の拡張機能アイコンをクリックするとポップアップが表示されます．ここでは各種設定を行ったり，使い方を見ることができます．

- ホワイトリストを編集
  - ホワイトリスト編集ページを開きます
- ブラックリストを編集
  - ブラックリスト編集ページを開きます
- このページをホワイトリストに追加
  - 現在表示しているページをホワイトリストに追加します
- サーバを変更
  - 遷移先ページの情報取得を行うサーバを変更することができます

---

*for developers*

## リポジトリの構成

```
/
|--- backend/
|       遷移先ページの情報取得を行うAPI(Golang)
|--- driver/
|       情報取得のためにChromeを動作させるドライバ(Golang)
|--- frontend/
        Chromeの拡張機能(HTML/CSS/JS)
```

## 構成技術

### 全体構成

![](https://user-images.githubusercontent.com/41366495/194413609-cdcba445-769c-437d-8743-5e4fa847c4cd.png)

### Backend / Worker

- Golang製
  - 初期実装はPythonだった
  - Pythonの速度面，パラダイム面の問題に直面し全ての実装を移行
- Dockerで可搬性を確保
  - セルフホスティングも可能な設計
- 冗長化を前提としたスケール可能な設計
  - ワーカーとなるプログラムはインターネット接続さえあれば動作
- 動作はGCPのインスタンス x 2を使用
  - APIサーバとワーカーインスタンス
- 汚染を前提としたURLへのアクセス構成
  - VM上で簡単にロールバックができるように
- 高速なURL解決
  - 全体では複雑な構造で速度がかなり低下する
  - 並行処理，アクセス最適化による速度向上を実現

### Frontend

- HTML/CSS/JSで実装
- Material Designを使用
  - 見やすいデザイン，直感的な操作を実現

## 開発ロードマップ

### Backend / Worker

### Frontend

- phase1 ブラウザ拡張だけ
  - 短縮URLのリダイレクト検知とブロック，遷移確認ページの表示
  - 表示は遷移先URLだけ

- phase2 サーバ側python
  - ホワイトリストの追加(編集機能・現在のページ追加機能・追加して遷移機能)
  - ホワイトリストに含まれるページの遷移確認のスキップ
  - サーバ側からのタイトル・遷移先URL・サムネイルの取得

- phase3 サーバ側Go lang(プライバシーも考慮)
  - ブラックリストの追加(編集機能・追加してページを閉じる機能)
  - ブラックリストに含まれるページの自動ブロック
  - 安全性チェック(Google Safe Browsing，Norton Safe Web，Kaspersky Threat Intelligence Portal)
  - サーバの変更機能

- phase4 今後の展望
  - 複数端末でのホワイトリスト・ブラックリストの同期機能の追加
  - 対応する短縮URLの追加

## Licence

This software is released under the MIT License, see LICENSE.

---

*for MWSCup*

## 審査基準について

### 要件

- Github上で公開し，容易に利用・改変可能となっている
- チームで協力して作成している
- 成果物による法令順守違反及び倫理問題はない

### 新規性

- ホワイトリスト/ブラックリストによる短縮URL対策ツールの利便性の向上
- 設定により，すべて一端末で動作可能

### 実用性

- ホワイトリスト/ブラックリストにより，利便性を損なわずに悪質なURLへ遷移する短縮URLから人々を守れる

### 継続性

- 対応する短縮URLの種類の拡張
- ホワイトリストの同期機能の追加
- サンドボックスを複数用意することによる冗長性の向上

### チームワーク

コーディングに関しては適切に分担し，ペアプログラミングなどの手法も取り入れながら作業を進めた．
コーディングタスクが存在しないメンバーもツールの開発・発表に必要なタスクを適切に分担した．具体的なタスクの分担はプライバシーの関係でここでは省略する．
